<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì‚¬ ë° ë¬¸í•­ ê´€ë¦¬í˜• ìì†Œì„œ ì‘ì„± ë„êµ¬</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter í°íŠ¸ ì„¤ì • ë° ì „ì²´ í™”ë©´ ì‚¬ìš© */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; 
            padding: 0;
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow-x: hidden; 
            overflow-y: hidden;
        }
        
        textarea.resize {
            resize: vertical; /* ìˆ˜ì§ ë°©í–¥ìœ¼ë¡œë§Œ í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥ */
            min-height: 80px; /* ì§ˆë¬¸ ìµœì†Œ ë†’ì´ */
        }

        #item-editor-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }

        /* ì§ˆë¬¸ ì˜ì—­(#question)ì—ë§Œ ìµœëŒ€ ë†’ì´ ë° ìŠ¤í¬ë¡¤ ì„¤ì • */
        #question {
            /* 16ì¤„ ì œí•œ: 16ì¤„ * 24px (Line-height) + 24px (p-3 vertical padding) = 408px */
            max-height: 408px; 
            overflow-y: auto; /* max-height ì´ˆê³¼ ì‹œ ìŠ¤í¬ë¡¤ë°” í™œì„±í™” */
        }

        #answer {
            flex-grow: 1;
            min-height: 200px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
        }

        .list-item, .app-list-item, .search-result-item {
            cursor: pointer;
            transition: all 0.15s ease;
            border: 2px solid transparent;
        }
        .list-item:hover, .app-list-item:hover, .search-result-item:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body class="p-0 m-0 h-screen w-screen">

    <!-- Main Flex Container: App List (1/5) + Item Manager (1/5) + Editor (3/5) -->
    <div class="flex h-full w-full">
        
        <!-- 1. Leftmost Sidebar (íšŒì‚¬/App ëª©ë¡) -->
        <div id="app-list-sidebar" class="w-1/5 h-full bg-gray-50 border-r border-gray-200 shadow-xl flex flex-col min-w-[200px]">
            <div class="p-4 border-b border-gray-200 bg-white">
                
                <!-- [MODIFIED] íšŒì‚¬ ëª©ë¡ í—¤ë”: ì œëª©ê³¼ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ -->
                <div class="flex justify-between items-center relative">
                    <h3 class="text-sm font-bold uppercase text-gray-700">íšŒì‚¬ ëª©ë¡</h3>
                    <div class="flex space-x-2">
                        <!-- ğŸ’¾ ì €ì¥ ë²„íŠ¼ (ë””ìŠ¤ì¼“) -->
                        <div class="relative">
                            <button id="save-data-btn" title="ë°ì´í„° ì €ì¥" class="p-1 w-7 h-7 flex items-center justify-center text-gray-700 bg-gray-200 rounded-full shadow-md hover:bg-green-100 transition duration-150 transform hover:scale-105 active:scale-95">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>
                            </button>
                            <!-- ì €ì¥ í˜•ì‹ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
                            <div id="save-dropdown" class="absolute left-0 mt-2 w-32 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-20 transform -translate-x-full">
                                <button id="save-json-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">JSON íŒŒì¼ (.json)</button>
                                <button id="save-text-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg">Text íŒŒì¼ (.txt)</button>
                            </div>
                        </div>
                        
                        <!-- â¤’ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ (ì—…ë¡œë“œ) -->
                        <button id="load-data-btn" title="ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°" class="p-1 w-7 h-7 flex items-center justify-center text-gray-700 bg-gray-200 rounded-full shadow-md hover:bg-blue-100 transition duration-150 transform hover:scale-105 active:scale-95">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="p-4 overflow-y-auto flex-grow">
                
                <!-- í•„í„°/ê²€ìƒ‰ ë²„íŠ¼ ë° íšŒì‚¬ ì¶”ê°€/ì œê±° ë²„íŠ¼ -->
                <div class="flex justify-between items-center mb-3">
                    <div class="flex space-x-2">
                        <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                        <button id="search-toggle-btn" title="ì „ì²´ ë¬¸í•­ ê²€ìƒ‰" class="px-3 py-1 text-xs font-bold text-white bg-indigo-500 rounded-lg shadow-md hover:bg-indigo-600 transition duration-150 transform hover:scale-[1.02] active:scale-[0.98]">
                            ê²€ìƒ‰
                        </button>
                        <!-- í•„í„° ë²„íŠ¼: ì˜¤ë¥¸ìª½ ê³µê°„ì„ í•„í„° ë©”ë‰´ë¡œ ì „í™˜í•©ë‹ˆë‹¤. -->
                        <button id="filter-toggle-btn" title="íšŒì‚¬ ìƒíƒœ í•„í„°" class="p-1 w-7 h-7 text-xs flex items-center justify-center font-bold text-white bg-gray-500 rounded-full shadow-md hover:bg-gray-600 transition duration-150 transform hover:scale-105 active:scale-95">
                            <!-- Filter icon SVG -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L14 13.414V17a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3.586L3.293 6.707A1 1 0 013 6V4z" />
                            </svg>
                        </button>
                    </div>

                    <!-- íšŒì‚¬ ì¶”ê°€/ì œê±° ë²„íŠ¼ -->
                    <div class="flex space-x-2">
                        <button id="add-app-btn" title="íšŒì‚¬ ì¶”ê°€" class="p-1 w-7 h-7 text-xs flex items-center justify-center font-bold text-white bg-green-600 rounded-full shadow-md hover:bg-green-700 transition duration-150 transform hover:scale-105 active:scale-95">
                            +
                        </button>
                        <button id="remove-app-btn" title="ì„ íƒ íšŒì‚¬ ì œê±°" class="p-1 w-7 h-7 text-xs flex items-center justify-center font-bold text-gray-700 bg-gray-200 rounded-full shadow-md hover:bg-red-100 transition duration-150 transform hover:scale-105 active:scale-95">
                            X
                        </button>
                    </div>
                </div>
                
                <ul id="app-list" class="space-y-1">
                    <!-- íšŒì‚¬ ëª©ë¡ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤ -->
                </ul>
            </div>
        </div>
        
        <!-- 2. Middle Sidebar (ì„ íƒëœ íšŒì‚¬/ë¬¸í•­ ëª©ë¡ OR í•„í„° ë©”ë‰´ OR ê²€ìƒ‰ ë©”ë‰´) -->
        <div id="item-manager-sidebar" class="w-1/5 h-full bg-slate-100 border-r border-gray-200 shadow-2xl flex flex-col min-w-[280px] relative">
            
            <!-- ì›ë˜ì˜ íšŒì‚¬ ìƒì„¸ ì •ë³´ ë° ë¬¸í•­ ëª©ë¡ -->
            <div id="original-content-container" class="flex flex-col h-full w-full">
                
                <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„¸ ì •ë³´ (íšŒì‚¬ëª…, ë‚ ì§œ, ìƒíƒœ) ì„¹ì…˜ -->
                <div id="app-details-section" class="p-4 border-b border-gray-200 bg-white space-y-3">
                    <h3 class="text-sm font-bold uppercase text-gray-700 mb-3">ì„ íƒëœ íšŒì‚¬</h3>
                    
                    <!-- íšŒì‚¬ëª… -->
                    <div class="flex items-center space-x-2">
                        <label for="app-company" class="font-bold text-gray-700 text-sm flex-shrink-0 w-12">íšŒì‚¬ëª…</label>
                        <input type="text" id="app-company" class="p-1 border border-gray-300 rounded-lg text-base flex-grow focus:ring-cyan-500 focus:border-cyan-500 min-w-0" placeholder="íšŒì‚¬/ì§ë¬´">
                    </div>

                    <!-- ë‚ ì§œ ë° ìƒíƒœë¥¼ ìˆ˜ì§ìœ¼ë¡œ ì •ë ¬ -->
                    <div class="space-y-3">
                        <!-- ë‚ ì§œ -->
                        <div class="flex items-center space-x-2">
                            <label for="app-date" class="font-bold text-gray-700 text-sm flex-shrink-0 w-12">ë‚ ì§œ</label>
                            <input type="date" id="app-date" class="p-1 border border-gray-300 rounded-lg text-base flex-grow focus:ring-cyan-500 focus:border-cyan-500">
                        </div>
                        
                        <!-- ìƒíƒœ -->
                        <div class="flex items-center space-x-2">
                            <label for="app-status" class="font-bold text-gray-700 text-sm flex-shrink-0 w-12">ìƒíƒœ</label>
                            <select id="app-status" class="p-1 border border-gray-300 rounded-lg text-base flex-grow focus:ring-cyan-500 focus:border-cyan-500">
                                <option value="ê¸°ë³¸" selected>ê¸°ë³¸</option>
                                <option value="ì„œí•©">ì„œí•©</option>
                                <option value="ì„œíƒˆ">ì„œíƒˆ</option>
                                <option value="ë©´ì ‘">ë©´ì ‘</option>
                                <option value="í•©ê²©">í•©ê²©</option>
                                <option value="1ì°¨ë©´ì ‘">1ì°¨ë©´ì ‘</option>
                                <option value="2ì°¨ë©´ì ‘">2ì°¨ë©´ì ‘</option>
                                <option value="ìµœì¢…ë©´ì ‘">ìµœì¢…ë©´ì ‘</option>
                                <option value="í…ŒìŠ¤íŠ¸">í…ŒìŠ¤íŠ¸</option>
                                <option value="í¬í´">í¬í´</option>
                                <option value="ê³¼ì œ">ê³¼ì œ</option>
                                <option value="ë©”ëª¨">ë©”ëª¨</option>
                                <option value="TIP">TIP</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ë¬¸í•­ ëª©ë¡ ì„¹ì…˜ -->
                <div class="p-4 overflow-y-auto flex-grow">
                    
                    <!-- ë¬¸í•­ ëª©ë¡ ë¼ë²¨ê³¼ ë²„íŠ¼ì„ í•œ ì¤„ì— ë°°ì¹˜ -->
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-bold uppercase text-gray-700">ë¬¸í•­ ëª©ë¡</h3>
                        
                        <!-- ì‘ê²Œ ì¤„ì—¬ì„œ ë°°ì¹˜ëœ ë²„íŠ¼ë“¤ -->
                        <div class="flex space-x-2">
                            <button id="add-item-btn" title="ë¬¸í•­ ì¶”ê°€" class="p-1 w-7 h-7 text-xs flex items-center justify-center font-bold text-white bg-cyan-600 rounded-full shadow-md hover:bg-cyan-700 transition duration-150 transform hover:scale-105 active:scale-95">
                                +
                            </button>
                            <button id="remove-item-btn" title="ì„ íƒ ë¬¸í•­ ì œê±°" class="p-1 w-7 h-7 text-xs flex items-center justify-center font-bold text-gray-700 bg-gray-200 rounded-full shadow-md hover:bg-red-100 transition duration-150 transform hover:scale-105 active:scale-95">
                                X
                            </button>
                        </div>
                    </div>

                    <ul id="item-list" class="space-y-1">
                        <!-- ë¬¸í•­ ëª©ë¡ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤ -->
                    </ul>
                </div>
            </div> <!-- End of #original-content-container -->

            <!-- í•„í„° ë©”ë‰´ (Middle Sidebarì˜ ê³µê°„ì„ ì‚¬ìš©) -->
            <div id="filter-menu" class="hidden absolute inset-0 p-4 bg-gray-100 flex flex-col overflow-y-auto">
                
                <!-- í•„í„° í—¤ë” -->
                <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-300 bg-gray-100 sticky top-0 z-10">
                    <h4 class="text-lg font-bold text-gray-800">íšŒì‚¬ ìƒíƒœ í•„í„°</h4>
                    <button id="close-filter-btn" title="í•„í„° ë‹«ê¸°" class="p-1 text-gray-500 hover:text-red-500 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- Action Buttons: ì „ì²´ ì„ íƒ/í•´ì œ/íšŒì‚¬ë§Œ -->
                <div class="flex space-x-2 mb-4">
                    <button id="select-all-btn" class="flex-grow px-3 py-1 text-sm font-bold text-white bg-indigo-500 rounded-lg shadow-md hover:bg-indigo-600 transition duration-150 transform hover:scale-[1.01] active:scale-[0.99]">
                        ì „ì²´ ì„ íƒ
                    </button>
                    <button id="select-none-btn" class="flex-grow px-3 py-1 text-sm font-bold text-gray-700 bg-gray-200 rounded-lg shadow-md hover:bg-gray-300 transition duration-150 transform hover:scale-[1.01] active:scale-[0.99]">
                        ì „ì²´ í•´ì œ
                    </button>
                    <button id="select-company-only-btn" class="flex-grow px-3 py-1 text-sm font-bold text-white bg-cyan-600 rounded-lg shadow-md hover:bg-cyan-700 transition duration-150 transform hover:scale-[1.01] active:scale-[0.99]">
                        íšŒì‚¬ë§Œ
                    </button>
                </div>

                <!-- ì²´í¬ë°•ìŠ¤ ëª©ë¡ì´ ë“¤ì–´ê°ˆ ê³³ (1ì—´ ëª©ë¡ í˜•íƒœë¡œ ë³€ê²½) -->
                <div id="status-checkboxes" class="grid grid-cols-1 gap-1 text-sm flex-grow">
                    <!-- Checkboxes will be rendered here by JavaScript -->
                </div>
                
            </div>

            <!-- ê²€ìƒ‰ ë©”ë‰´ -->
            <div id="search-menu" class="hidden absolute inset-0 p-4 bg-gray-100 flex flex-col overflow-y-auto">
        
                <!-- ê²€ìƒ‰ í—¤ë” -->
                <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-300 bg-gray-100 sticky top-0 z-10">
                    <h4 class="text-lg font-bold text-gray-800">ë¬¸í•­ ê²€ìƒ‰</h4>
                    <button id="close-search-btn" title="ê²€ìƒ‰ ë‹«ê¸°" class="p-1 text-gray-500 hover:text-red-500 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- ê²€ìƒ‰ ì…ë ¥ í•„ë“œ -->
                <input type="text" id="search-input" placeholder="íšŒì‚¬ëª…, ì§ˆë¬¸, ë‹µë³€, ìœ í˜• ê²€ìƒ‰..." class="w-full p-2 mb-4 border border-indigo-400 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-base shadow-md">

                <!-- ê²€ìƒ‰ í•„í„° ì„¤ì • ë²„íŠ¼ -->
                <div class="mb-4 flex justify-between items-center pt-2 border-t border-gray-300">
                    <p class="text-sm font-bold text-gray-700 ml-1">ê²€ìƒ‰ ëŒ€ìƒ í•„ë“œ</p>
                    <button id="open-search-filter-modal-btn" class="px-3 py-1 text-xs font-bold text-white bg-indigo-500 rounded-lg shadow-md hover:bg-indigo-600 transition duration-150 transform hover:scale-[1.02] active:scale-[0.98]">
                        í•„í„° ì„¤ì • (0 / 4)
                    </button>
                </div>

                <!-- ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ -->
                <div class="mb-2">
                    <p id="search-info" class="text-sm text-gray-500 font-medium ml-1">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                </div>
                <div id="search-results-container" class="space-y-3 flex-grow overflow-y-auto">
                    <!-- Results will be displayed here -->
                </div>
                
            </div>

        </div> <!-- End of #item-manager-sidebar -->

        <!-- 3. Right Main Content (ë¬¸í•­ ì‘ì„± ì—ë””í„°) -->
        <div class="w-3/5 h-full p-4 md:p-8 overflow-y-auto flex-grow">

            <!-- ì—ë””í„° ì˜ì—­ (ê¸°ì¡´ì˜ item-1 ë¸”ë¡) -->
            <div id="item-editor-container" class="rounded-xl shadow-2xl border border-gray-200 p-6 bg-white">
                
                <!-- 0. ë¬¸í•­ ê´€ë¦¬ í—¤ë” (ì œëª©, íƒ€ì…, ì§ˆë¬¸ ìœ í˜•, ì½ê¸° ì „ìš©) -->
                <div class="mb-4 pb-2 space-y-4">
                    
                    <!-- 1í–‰: ë¬¸í•­ ì œëª© (ì „ì²´ ê³µê°„ ì ìœ ) + ì½ê¸° ì „ìš© (ê°€ì¥ ì˜¤ë¥¸ìª½) -->
                    <div class="flex flex-wrap items-center gap-4 md:gap-6">
                        
                        <!-- ë¬¸í•­ ì œëª© ë¼ë²¨ ë° Input (ë‚¨ì€ ê³µê°„ ì „ì²´ ì°¨ì§€) -->
                        <div class="flex flex-grow items-center space-x-2 min-w-40">
                            <label for="item-title" class="font-bold text-gray-700 text-sm flex-shrink-0 w-20">ë¬¸í•­ ì œëª©</label>
                            <input type="text" id="item-title" class="p-2 border border-gray-300 rounded-lg text-base flex-grow focus:ring-cyan-500 focus:border-cyan-500" placeholder="ì˜ˆ: ì§€ì› ë™ê¸° ë° í¬ë¶€">
                        </div>

                        <!-- ì½ê¸° ì „ìš© (Checkbox - 1ë²ˆì§¸ í–‰, ê°€ì¥ ì˜¤ë¥¸ìª½ì— ìœ„ì¹˜) -->
                        <div class="flex items-center flex-shrink-0 select-none ml-auto">
                            <input type="checkbox" id="is-readonly" class="h-4 w-4 text-gray-600 border-gray-300 rounded focus:ring-gray-500 cursor-pointer">
                            <label for="is-readonly" class="font-bold text-gray-700 text-base ml-2 cursor-pointer">ì½ê¸° ì „ìš©</label>
                        </div>
                    </div>

                    <!-- 2í–‰: ë¬¸í•­ íƒ€ì… + ì§ˆë¬¸ ìœ í˜• (ê°ê° ì ˆë°˜ì”© ê³µê°„ ì ìœ ) -->
                    <div class="flex flex-wrap items-center gap-4 md:gap-6">
                        
                        <!-- ë¬¸í•­ íƒ€ì… (Dropdown - ìˆ˜í‰ ì •ë ¬, ì•½ 40% ê³µê°„) -->
                        <div class="flex items-center space-x-2 w-full md:w-auto md:flex-grow">
                            <label for="item-type-select" class="font-bold text-gray-700 text-sm flex-shrink-0 w-20">ë¬¸í•­ íƒ€ì…</label>
                            <select id="item-type-select" class="p-2 border border-gray-300 rounded-lg text-base w-full focus:ring-cyan-500 focus:border-cyan-500">
                                <option value="ìì†Œì„œ" selected>ìì†Œì„œ</option>
                                <option value="ê¸°ìˆ ">ê¸°ìˆ </option>
                                <option value="ë©”ëª¨">ë©”ëª¨</option>
                                <option value="ë°©ë²•">ë°©ë²•</option>
                                <option value="ì˜ˆì‹œ">ì˜ˆì‹œ</option>
                                <option value="TIP">TIP</option>
                            </select>
                        </div>

                        <!-- ì§ˆë¬¸ ìœ í˜• ë¼ë²¨ ë° Input (ìˆ˜í‰ ì •ë ¬, ë‚˜ë¨¸ì§€ ê³µê°„ ì ìœ ) -->
                        <div class="flex items-center space-x-2 w-full md:w-auto md:flex-grow">
                            <label for="item-tag-type" class="font-bold text-gray-700 text-sm flex-shrink-0 w-20">ì§ˆë¬¸ ìœ í˜•</label>
                            <input type="text" id="item-tag-type" class="p-2 border border-gray-300 rounded-lg text-base w-full focus:ring-cyan-500 focus:border-cyan-500 flex-grow" placeholder="ì˜ˆ: ì„±ì¥ê³¼ì •, ì§ë¬´ê²½í—˜">
                        </div>
                    </div>
                </div>

                <!-- 1. ì§ˆë¬¸ (Full Width) -->
                <div class="mb-4">
                    <label for="question" class="block text-xl font-bold text-gray-700 mb-2">
                        ì§ˆë¬¸
                    </label>
                    <textarea id="question" class="w-full resize p-3 border border-gray-300 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 transition duration-150 text-base" rows="5" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”." aria-label="ì§ˆë¬¸ ì…ë ¥ ì˜ì—­"></textarea>
                </div>

                <!-- 2. ë‹µë³€ (Full Width & Expanded) -->
                <div class="flex flex-col flex-grow">
                    
                    <!-- ë¼ë²¨ê³¼ ê¸€ììˆ˜ ì¸¡ì • ê²°ê³¼ë¥¼ í•œ ì¤„ì— ì •ë ¬ -->
                    <div class="flex justify-between items-center mb-2">
                        <label for="answer" class="text-xl font-bold text-gray-700">
                            ë‹µë³€
                        </label>
                        <!-- ê¸€ììˆ˜ ì¸¡ì • ê²°ê³¼ (ë¼ë²¨ ì˜†ì— ìœ„ì¹˜) -->
                        <div id="char-count-display" class="text-base flex space-x-4 font-mono">
                            <span class="count-with-spaces text-blue-600 font-semibold">ê³µë°± í¬í•¨: 0ì</span>
                            <span class="count-without-spaces text-green-600 font-semibold">ê³µë°± ì œì™¸: 0ì</span>
                        </div>
                    </div>
                    
                    <!-- ë‹µë³€ textareaê°€ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ flex-grow ì‚¬ìš© -->
                    <textarea id="answer" class="w-full resize p-3 border border-gray-300 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 transition duration-150 text-base overflow-y-auto" placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì‘ì„±í•˜ì„¸ìš”." aria-label="ë‹µë³€ ì…ë ¥ ì˜ì—­"></textarea>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Custom Modal UI for Confirmation -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4 text-red-600">í™•ì¸</h3>
            <p id="modal-message" class="mb-6 text-gray-700">ì´ ë¬¸í•­ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">ì·¨ì†Œ</button>
                <button id="modal-confirm-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <!-- Custom Modal UI for Messages/Alerts -->
    <div id="message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 id="message-modal-title" class="text-xl font-bold mb-4 text-indigo-600">ì•Œë¦¼</h3>
            <p id="message-modal-message" class="mb-6 text-gray-700">ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <div class="flex justify-end">
                <button id="message-modal-close-btn" class="px-4 py-2 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal UI for Search Field Filters -->
    <div id="search-filter-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4 text-indigo-600">ê²€ìƒ‰ í•„ë“œ ì„ íƒ</h3>
            <p class="mb-4 text-sm text-gray-600">ê²€ìƒ‰ì„ ì›í•˜ëŠ” í•„ë“œ(íšŒì‚¬ëª…, ì§ˆë¬¸, ë‹µë³€, ìœ í˜•)ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>

            <div id="search-filter-checkboxes-modal" class="grid grid-cols-2 gap-3 mb-6">
                <!-- Checkboxes will be rendered here -->
            </div>

            <div class="flex justify-end space-x-3">
                <button id="search-filter-modal-close-btn" class="px-4 py-2 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden File Input for Loading -->
    <input type="file" id="file-loader" class="hidden" accept=".json, .txt">

    <script>
        // ===============================================
        // 1. ë°ì´í„° êµ¬ì¡° ë° ì „ì—­ ìƒíƒœ
        // ===============================================

        // ë¬¸í•­ ë°ì´í„°ì˜ ê¸°ë³¸ êµ¬ì¡°
        const defaultItem = (num) => ({
            id: Date.now() + Math.random(),
            title: `ìƒˆ ë¬¸í•­ #${num}`,
            type: "ìì†Œì„œ",
            tags: "",
            question: "",
            answer: "",
            isReadOnly: false
        });
        
        // ì• í”Œë¦¬ì¼€ì´ì…˜(íšŒì‚¬) ë°ì´í„°ì˜ ê¸°ë³¸ êµ¬ì¡°
        const defaultApplication = (num) => {
            const appId = crypto.randomUUID();
            return {
                id: appId,
                company: `ìƒˆ íšŒì‚¬ #${num}`,
                date: new Date().toISOString().substring(0, 10),
                status: "ê¸°ë³¸",
                // ê° ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ìì²´ ë¬¸í•­ ëª©ë¡ì„ ê°€ì§‘ë‹ˆë‹¤.
                items: [defaultItem(1)] 
            };
        };

        // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
        let applications = [defaultApplication(1)]; // ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜(íšŒì‚¬)ì„ ë‹´ëŠ” ë°°ì—´
        let selectedAppId = applications[0].id;     // í˜„ì¬ ì„ íƒëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ID
        let selectedItemIndex = 0;                  // í˜„ì¬ ì„ íƒëœ ë¬¸í•­ì˜ ì¸ë±ìŠ¤
        let modalResolve = null;                    // ì»¤ìŠ¤í…€ ëª¨ë‹¬ Promise Resolver
        
        // í•„í„°ë§ ìƒíƒœ ê´€ë¦¬ - ì‹¤ì‹œê°„ ì ìš©ì„ ìœ„í•´ activeStatusesë¥¼ ì§ì ‘ ì‚¬ìš©
        let activeStatuses = [];                    // ì‹¤ì œë¡œ ëª©ë¡ ë Œë”ë§ì— ì‚¬ìš©ë˜ëŠ” í™œì„± ìƒíƒœ í•„í„°
        
        // ê²€ìƒ‰ ìƒíƒœ ê´€ë¦¬
        let searchResults = [];                     // ë§ˆì§€ë§‰ ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
        let lastSearchQuery = '';                   // ë§ˆì§€ë§‰ ê²€ìƒ‰ ì¿¼ë¦¬ ì €ì¥
        
        // ê²€ìƒ‰ í•„í„° ìƒíƒœ ê´€ë¦¬
        const searchFields = ["íšŒì‚¬ëª…", "ì§ˆë¬¸", "ë‹µë³€", "ìœ í˜•"];
        let activeSearchFilters = [...searchFields]; // ê¸°ë³¸ê°’: ëª¨ë“  í•„í„° í™œì„±í™”
        
        // 'íšŒì‚¬' ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì¼ ìƒíƒœ ëª©ë¡ (í•©ê²© í¬í•¨)
        const companyStatuses = ["ê¸°ë³¸", "ì„œí•©", "ì„œíƒˆ", "ë©´ì ‘", "í•©ê²©", "1ì°¨ë©´ì ‘", "2ì°¨ë©´ì ‘", "ìµœì¢…ë©´ì ‘", "í…ŒìŠ¤íŠ¸"];
        
        // ëª¨ë“  ê°€ëŠ¥í•œ ìƒíƒœ ëª©ë¡ (ìˆœì„œ: ë“œë¡­ë‹¤ìš´ ìˆœì„œë¥¼ ë”°ë¦„)
        const filterOrder = ["ê¸°ë³¸", "ì„œí•©", "ì„œíƒˆ", "ë©´ì ‘", "í•©ê²©", "1ì°¨ë©´ì ‘", "2ì°¨ë©´ì ‘", "ìµœì¢…ë©´ì ‘", "í…ŒìŠ¤íŠ¸", "í¬í´", "ê³¼ì œ", "ë©”ëª¨", "TIP"];


        // ===============================================
        // 2. HTML ìš”ì†Œ ì°¸ì¡°
        // ===============================================
        const editorContainer = document.getElementById('item-editor-container');
        
        // íšŒì‚¬/App ëª©ë¡ ìš”ì†Œ
        const appListUl = document.getElementById('app-list');
        const addAppBtn = document.getElementById('add-app-btn');
        const removeAppBtn = document.getElementById('remove-app-btn');
        const filterToggleButton = document.getElementById('filter-toggle-btn'); 
        const searchToggleButton = document.getElementById('search-toggle-btn'); 

        // [NEW] ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ìš”ì†Œ
        const saveDataBtn = document.getElementById('save-data-btn');
        const loadDataBtn = document.getElementById('load-data-btn');
        const saveDropdown = document.getElementById('save-dropdown');
        const saveJsonBtn = document.getElementById('save-json-btn');
        const saveTextBtn = document.getElementById('save-text-btn');
        const fileLoader = document.getElementById('file-loader');
        
        // Middle Sidebar Container References
        const originalContentContainer = document.getElementById('original-content-container');
        const filterMenu = document.getElementById('filter-menu'); 
        const closeFilterBtn = document.getElementById('close-filter-btn'); 
        const statusCheckboxesDiv = document.getElementById('status-checkboxes'); 
        const searchMenu = document.getElementById('search-menu');           
        const searchInput = document.getElementById('search-input');         
        const searchResultsContainer = document.getElementById('search-results-container'); 
        const closeSearchBtn = document.getElementById('close-search-btn');  
        const searchInfo = document.getElementById('search-info');           
        
        // ê²€ìƒ‰ í•„í„° ëª¨ë‹¬ ìš”ì†Œ
        const searchFilterModal = document.getElementById('search-filter-modal');
        const openSearchFilterModalBtn = document.getElementById('open-search-filter-modal-btn');
        const searchFilterCheckboxesModalDiv = document.getElementById('search-filter-checkboxes-modal');
        const searchFilterModalCloseBtn = document.getElementById('search-filter-modal-close-btn');
        
        // Filter Action Buttons
        const selectAllBtn = document.getElementById('select-all-btn');
        const selectCompanyOnlyBtn = document.getElementById('select-company-only-btn');
        const selectNoneBtn = document.getElementById('select-none-btn'); 

        // App ìƒì„¸ ì •ë³´ ìš”ì†Œ
        const appCompanyInput = document.getElementById('app-company');
        const appDateInput = document.getElementById('app-date');
        const appStatusSelect = document.getElementById('app-status');

        // ë¬¸í•­ ëª©ë¡ ìš”ì†Œ
        const itemListUl = document.getElementById('item-list');
        const addItemBtn = document.getElementById('add-item-btn');
        const removeItemBtn = document.getElementById('remove-item-btn');

        // ë¬¸í•­ í¸ì§‘ê¸° ìš”ì†Œ
        const titleInput = document.getElementById('item-title');
        const typeSelect = document.getElementById('item-type-select');
        const tagsInput = document.getElementById('item-tag-type');
        const readonlyCheckbox = document.getElementById('is-readonly');
        const questionTextarea = document.getElementById('question');
        const answerTextarea = document.getElementById('answer');
        
        // ëª¨ë‹¬ ìš”ì†Œ
        const confirmModal = document.getElementById('confirm-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        
        const messageModal = document.getElementById('message-modal');
        const messageModalTitle = document.getElementById('message-modal-title');
        const messageModalMessage = document.getElementById('message-modal-message');
        const messageModalCloseBtn = document.getElementById('message-modal-close-btn');


        // ===============================================
        // 3. ë°ì´í„° ê´€ë¦¬ í—¬í¼ í•¨ìˆ˜
        // ===============================================

        /**
         * í—¬í¼: í˜„ì¬ ì„ íƒëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function getCurrentApplication() {
            return applications.find(app => app.id === selectedAppId);
        }

        /**
         * í—¬í¼: í˜„ì¬ ë¬¸í•­ ë°ì´í„° ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function getCurrentItem() {
            const app = getCurrentApplication();
            if (app && app.items.length > 0) {
                 // ì„ íƒëœ ì¸ë±ìŠ¤ê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ê³  ì¡°ì •
                if (selectedItemIndex >= app.items.length) {
                    selectedItemIndex = Math.max(0, app.items.length - 1);
                }
                return app.items[selectedItemIndex];
            }
            return null;
        }

        /**
         * í—¬í¼: í˜„ì¬ í¸ì§‘ê¸° í•„ë“œì˜ ê°’ì„ ë¬¸í•­ ë°ì´í„°ì— ì €ì¥í•©ë‹ˆë‹¤.
         */
        function saveCurrentItem() {
            const currentItem = getCurrentItem();
            if (!currentItem) return;

            // UIì—ì„œ ë³€ê²½ëœ ë‚´ìš©ì„ ìƒíƒœì— ë°˜ì˜
            currentItem.title = titleInput.value;
            currentItem.type = typeSelect.value;
            currentItem.tags = tagsInput.value;
            currentItem.question = questionTextarea.value;
            currentItem.answer = answerTextarea.value;
            currentItem.isReadOnly = readonlyCheckbox.checked;

            // ë¬¸í•­ ëª©ë¡ UI ì—…ë°ì´íŠ¸
            renderSidebar();
        }

        /**
         * ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒë‹¨ ì •ë³´ (íšŒì‚¬ëª…, ìƒíƒœ, ë‚ ì§œ)ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
         */
        function saveApplicationData() {
            const app = getCurrentApplication();
            if (!app) return;
            
            const oldDate = app.date;
            const oldStatus = app.status;
            
            app.company = appCompanyInput.value;
            app.status = appStatusSelect.value;
            app.date = appDateInput.value;
            
            // ìƒíƒœë‚˜ ë‚ ì§œê°€ ë³€ê²½ë˜ì—ˆì„ ê²½ìš° íšŒì‚¬ ëª©ë¡ UI ì—…ë°ì´íŠ¸ë¥¼ ê°•ì œ
            // appCompanyInput.valueê°€ ë³€ê²½ë  ê²½ìš°ì—ë„ renderAppListê°€ í˜¸ì¶œë˜ë„ë¡ 
            // setEventListenersì—ì„œ ë³„ë„ë¡œ ì²˜ë¦¬í•¨ (ì‹¤ì‹œê°„ ë°˜ì˜)
            if (oldStatus !== app.status || oldDate !== app.date) {
                 renderAppList();
            }
        }

        /**
         * í—¬í¼: í…ìŠ¤íŠ¸ ì˜ì—­ì˜ ë†’ì´ë¥¼ ë‚´ìš©ì— ë”°ë¼ ìë™ìœ¼ë¡œ í™•ì¥í•©ë‹ˆë‹¤.
         * ìµœëŒ€ ë†’ì´ëŠ” CSSì˜ max-height (408px, 16ì¤„)ì— ì˜í•´ ì œì–´ë©ë‹ˆë‹¤.
         */
        function autoExpandQuestionTextarea(element) {
            if (!element) return;
            // 1. ë†’ì´ë¥¼ 'auto'ë¡œ ì„¤ì •í•˜ì—¬ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¸°ê³  í˜„ì¬ ë‚´ìš©ì— ë§ê²Œ ì¤„ì…ë‹ˆë‹¤.
            element.style.height = 'auto';
            
            // 2. scrollHeightë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ê°€ ëª¨ë‘ ë³´ì´ë„ë¡ ë†’ì´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
            // ì´ë•Œ CSSì˜ max-heightê°€ ì ìš©ë˜ì–´ 16ì¤„ì„ ì´ˆê³¼í•˜ë©´ ìŠ¤í¬ë¡¤ë°”ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.
            element.style.height = (element.scrollHeight) + 'px';
        }


        // ===============================================
        // 4. UI ë Œë”ë§ ë° ì—…ë°ì´íŠ¸
        // ===============================================
        
        /**
         * ë¬¸í•­ íƒ€ì…ì— ë”°ë¼ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. (ì—ë””í„° ë³¸ë¬¸ìš© - ë°ì€ ë°°ê²½)
         */
        function getEditorColorClass(type) {
            switch (type) {
                case 'ê¸°ìˆ ': return 'bg-lime-100';
                case 'ë©”ëª¨': return 'bg-yellow-100'; // ì—°í•œ ë…¸ë€ìƒ‰
                case 'ë°©ë²•': return 'bg-violet-100';
                case 'ì˜ˆì‹œ': return 'bg-rose-100';
                case 'TIP': return 'bg-purple-100'; // ì—°í•œ ë³´ë¼ìƒ‰
                case 'ìì†Œì„œ':
                default: return 'bg-white';
            }
        }

        /**
         * ë¬¸í•­ íƒ€ì…ì— ë”°ë¼ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. (ëª©ë¡ í•­ëª©ìš© - ë¯¸ì„ íƒ)
         */
        function getListColorClass(type) {
            switch (type) {
                case 'ê¸°ìˆ ': return 'bg-lime-200';
                case 'ë©”ëª¨': return 'bg-yellow-200'; // ì—°í•œ ë…¸ë€ìƒ‰
                case 'ë°©ë²•': return 'bg-violet-200';
                case 'ì˜ˆì‹œ': return 'bg-rose-200';
                case 'TIP': return 'bg-purple-200'; // ì—°í•œ ë³´ë¼ìƒ‰
                case 'ìì†Œì„œ':
                default: return 'bg-blue-50';
            }
        }
        
        /**
         * ë¬¸í•­ íƒ€ì…ì— ë”°ë¼ ì„ íƒë˜ì—ˆì„ ë•Œì˜ ìƒ‰ìƒ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. (ëª©ë¡ í•­ëª©ìš© - ì„ íƒë¨)
         */
        function getSelectedColorClasses(type) {
            switch (type) {
                case 'ê¸°ìˆ ': return { bg: 'bg-green-700', border: 'border-green-400' };
                case 'ë©”ëª¨': return { bg: 'bg-amber-700', border: 'border-amber-400' }; 
                case 'ë°©ë²•': return { bg: 'bg-fuchsia-700', border: 'border-fuchsia-400' };
                case 'ì˜ˆì‹œ': return { bg: 'bg-red-700', border: 'border-red-400' };
                case 'TIP': return { bg: 'bg-purple-700', border: 'border-purple-400' }; 
                case 'ìì†Œì„œ':
                default: return { bg: 'bg-blue-700', border: 'border-blue-400' };
            }
        }
        
        /**
         * ë¬¸í•­ íƒ€ì…ì— ë”°ë¼ ë°°ê²½ìƒ‰ì„ ë³€ê²½í•©ë‹ˆë‹¤.
         */
        function updateBackgroundColor(type) {
            const itemContainer = editorContainer;
            if (!itemContainer) return;

            const selectedType = type || 'ìì†Œì„œ'; // ê¸°ë³¸ê°’ ì„¤ì •
            
            // ëª¨ë“  ì ì¬ì ì¸ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ ëª©ë¡ (bg-*-100)
            const allColors = ['bg-lime-100', 'bg-yellow-100', 'bg-violet-100', 'bg-rose-100', 'bg-purple-100', 'bg-white'];

            // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ëª¨ë‘ ì œê±°
            allColors.forEach(cls => itemContainer.classList.remove(cls));

            // ìƒˆë¡œìš´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€
            itemContainer.classList.add(getEditorColorClass(selectedType));
        }
        
        /**
         * íšŒì‚¬ ìƒíƒœì— ë”°ë¼ ëª©ë¡ í•­ëª©ì˜ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         * ë°˜í™˜ ì‹œ, ë¯¸ì„ íƒ ë°°ê²½ìƒ‰ê³¼ ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í¬í•¨í•©ë‹ˆë‹¤.
         */
        function getAppListStatusColorClass(status) {
            // ê¸°ë³¸~í…ŒìŠ¤íŠ¸ + í•©ê²©ê¹Œì§€ëŠ” bg-whiteì™€ ì¤‘ë¦½ì ì¸ border ì‚¬ìš©
            if (companyStatuses.includes(status)) {
                return { 
                    bgClass: 'bg-white', 
                    borderClass: 'border-gray-300', 
                    textClass: 'text-gray-800',
                    selectedBgClass: 'bg-gray-200', // ì„ íƒ ì‹œ ë°°ê²½ìƒ‰
                    selectedBorderClass: 'border-gray-500', // ì„ íƒ ì‹œ í…Œë‘ë¦¬ìƒ‰
                    selectedTextClass: 'text-gray-900' // ì„ íƒ ì‹œ í…ìŠ¤íŠ¸ìƒ‰
                };
            }
            switch (status) {
                case 'í¬í´': return { 
                    bgClass: 'bg-purple-100', 
                    borderClass: 'border-purple-300', 
                    textClass: 'text-purple-900',
                    selectedBgClass: 'bg-purple-600', 
                    selectedBorderClass: 'border-purple-400', 
                    selectedTextClass: 'text-white' 
                };
                case 'ê³¼ì œ': return { 
                    bgClass: 'bg-amber-100', 
                    borderClass: 'border-amber-300', 
                    textClass: 'text-amber-900',
                    selectedBgClass: 'bg-amber-600', 
                    selectedBorderClass: 'border-amber-400', 
                    selectedTextClass: 'text-white' 
                };
                case 'ë©”ëª¨': return { 
                    bgClass: 'bg-sky-100', 
                    borderClass: 'border-sky-300', 
                    textClass: 'text-sky-900',
                    selectedBgClass: 'bg-sky-600', 
                    selectedBorderClass: 'border-sky-400', 
                    selectedTextClass: 'text-white' 
                };
                case 'TIP': return { 
                    bgClass: 'bg-indigo-100', 
                    borderClass: 'border-indigo-300', 
                    textClass: 'text-indigo-900',
                    selectedBgClass: 'bg-indigo-600', 
                    selectedBorderClass: 'border-indigo-400', 
                    selectedTextClass: 'text-white' 
                };
                default: return { 
                    bgClass: 'bg-gray-100', 
                    borderClass: 'border-gray-300', 
                    textClass: 'text-gray-800',
                    selectedBgClass: 'bg-gray-300', 
                    selectedBorderClass: 'border-gray-500', 
                    selectedTextClass: 'text-gray-900' 
                };
            }
        }
        
        /**
         * í—¬í¼: ë‚ ì§œ ìµœì‹ ìˆœìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì •ë ¬í•©ë‹ˆë‹¤. (ë‚´ë¦¼ì°¨ìˆœ)
         */
        function sortApplicationsByDate(apps) {
            return [...apps].sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  ë‚ ì§œê°€ ì•ìœ¼ë¡œ)
                return dateB.getTime() - dateA.getTime();
            });
        }

        /**
         * íšŒì‚¬ ëª©ë¡ì„ ì‚¬ì´ë“œë°”ì— ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤. (ì •ë ¬ ë° í•„í„°ë§ ì ìš©)
         */
        function renderAppList() {
            // 1. ì •ë ¬: ë‚ ì§œ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
            let displayApps = sortApplicationsByDate(applications);

            // 2. í•„í„°ë§: í™œì„± í•„í„° ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ í•„í„°ë§ì„ ì ìš©í•©ë‹ˆë‹¤.
            if (activeStatuses.length > 0) {
                displayApps = displayApps.filter(app => activeStatuses.includes(app.status));
            } else if (applications.length > 0 && filterOrder.length > 0) {
                 // activeStatusesê°€ ë¹„ì–´ìˆê³ , í•„í„° ì˜µì…˜ì´ ì¡´ì¬í•˜ë©´ (ì „ì²´ í•´ì œ ìƒíƒœ),
                 // ëª©ë¡ì— ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                 displayApps = [];
            }

            appListUl.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”

            if (displayApps.length === 0) {
                appListUl.innerHTML = '<li class="text-sm text-gray-500 p-2">í‘œì‹œí•  íšŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤. (í•„í„° í™•ì¸)</li>';
                return;
            }

            displayApps.forEach(app => {
                const li = document.createElement('li');
                
                // í•­ëª© ë†’ì´ë¥¼ ì¤„ì´ê¸° ìœ„í•´ p-1.5, flex ì‚¬ìš©
                let classes = 'app-list-item p-1.5 rounded-lg transition-all duration-150 shadow-sm flex flex-col border-2';
                const isSelected = app.id === selectedAppId;
                const colorConfig = getAppListStatusColorClass(app.status);


                if (isSelected) {
                    // â­ [ìˆ˜ì •] ì„ íƒëœ í•­ëª© ìŠ¤íƒ€ì¼: ê³ ìœ  ìƒíƒœ ìƒ‰ìƒì„ ê¸°ë°˜ìœ¼ë¡œ ì§„í•˜ê²Œ ì„¤ì •
                    classes += ` font-bold ${colorConfig.selectedTextClass} ${colorConfig.selectedBgClass} border-4 ${colorConfig.selectedBorderClass} shadow-lg`;
                    companyTextSize = 'text-base';
                    textColor = colorConfig.selectedTextClass;
                } else {
                    // ë¯¸ì„ íƒ í•­ëª© ìƒíƒœë³„ ìƒ‰ìƒ ì ìš©
                    classes += ` ${colorConfig.textClass} ${colorConfig.bgClass} ${colorConfig.borderClass}`;
                    classes += ' hover:border-cyan-300';
                    companyTextSize = 'text-sm';
                    textColor = colorConfig.textClass;
                }
                
                li.className = classes;
                
                const companyName = app.company.trim() || `(íšŒì‚¬ëª… ì—†ìŒ)`;
                
                // ìƒíƒœê°€ 'ê¸°ë³¸'ì¼ ê²½ìš° ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¹€
                const statusText = (app.status === 'ê¸°ë³¸') ? '' : app.status;

                // íšŒì‚¬ëª…, ìƒíƒœ, ë‚ ì§œë¥¼ í¬í•¨í•˜ë„ë¡ innerHTML ì¬êµ¬ì„± (compact layout)
                li.innerHTML = `
                    <div class="${companyTextSize} font-semibold truncate leading-tight ${textColor}">${companyName}</div>
                    <div class="flex justify-between items-center text-xs ${textColor} opacity-90 pt-0.5">
                        <span class="font-medium">${statusText}</span>
                        <span class="opacity-80">${app.date}</span>
                    </div>
                `;

                li.addEventListener('click', () => {
                    saveCurrentItem();
                    saveApplicationData();

                    selectedAppId = app.id;
                    selectedItemIndex = 0;
                    renderAppAndItemData();
                    
                    // íšŒì‚¬ ëª©ë¡ì—ì„œ í´ë¦­ ì‹œ, ê²€ìƒ‰/í•„í„° ë©”ë‰´ê°€ ì—´ë ¤ ìˆë‹¤ë©´ ë‹«ìŒ
                    if (!searchMenu.classList.contains('hidden')) toggleSearchMenu(false);
                    if (!filterMenu.classList.contains('hidden')) toggleFilterMenu(false);
                });

                appListUl.appendChild(li);
            });
            
            // ì œê±° ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            removeAppBtn.disabled = applications.length <= 1;
            removeAppBtn.classList.toggle('opacity-50', applications.length <= 1);
            removeAppBtn.classList.toggle('cursor-not-allowed', applications.length <= 1);
        }

        /**
         * ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒë‹¨ ì •ë³´ (íšŒì‚¬ëª…, ìƒíƒœ, ë‚ ì§œ)ë¥¼ UIì— ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function renderApplicationData() {
            const app = getCurrentApplication();
            if (!app) return;

            appCompanyInput.value = app.company;
            appDateInput.value = app.date;
            appStatusSelect.value = app.status;
        }

        /**
         * ë¬¸í•­ ëª©ë¡ì„ ì‚¬ì´ë“œë°”ì— ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
         */
        function renderSidebar() {
            const app = getCurrentApplication();

            if (!app) {
                itemListUl.innerHTML = '<li class="text-sm text-gray-500 p-2">ì„ íƒëœ íšŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }

            itemListUl.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”

            app.items.forEach((item, index) => {
                const li = document.createElement('li');
                
                let classes = 'list-item p-2 rounded-lg truncate transition-all duration-150 border-2 border-gray-400 text-gray-800';
                classes += ' ' + getListColorClass(item.type);

                if (index === selectedItemIndex) {
                    const selectedClasses = getSelectedColorClasses(item.type);
                    classes = `list-item p-2 rounded-lg truncate transition-all duration-150 font-bold text-white ${selectedClasses.bg} border-4 ${selectedClasses.border} shadow-lg`;
                } else {
                    classes += ' hover:border-cyan-300';
                }
                
                li.className = classes;
                li.textContent = item.title.trim() || `(ì œëª© ì—†ìŒ #${index + 1})`;

                li.addEventListener('click', () => {
                    // í˜„ì¬ í¸ì§‘ ì¤‘ì´ë˜ ë‚´ìš© ì €ì¥
                    saveCurrentItem();
                    // ìƒˆ ë¬¸í•­ ì„ íƒ
                    selectedItemIndex = index;
                    renderCurrentItem();
                });

                itemListUl.appendChild(li);
            });
            
            // ë¬¸í•­ ì œê±° ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            removeItemBtn.disabled = app.items.length === 0;
            removeItemBtn.classList.toggle('opacity-50', app.items.length === 0);
            removeItemBtn.classList.toggle('cursor-not-allowed', app.items.length === 0);
        }

        /**
         * ì„ íƒëœ ë¬¸í•­ì˜ ë°ì´í„°ë¥¼ ì—ë””í„°ì— ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function renderCurrentItem() {
            const item = getCurrentItem();
            const app = getCurrentApplication();

            if (!item || !app) {
                // ë¬¸í•­ì´ ì—†ì„ ê²½ìš° ì—ë””í„°ë¥¼ ë¹„í™œì„±í™”
                titleInput.value = '';
                typeSelect.value = 'ìì†Œì„œ';
                tagsInput.value = '';
                questionTextarea.value = '';
                answerTextarea.value = '';
                readonlyCheckbox.checked = false;
                
                updateBackgroundColor('ìì†Œì„œ');
                updateCharCount();
                
                // ì—ë””í„° í•„ë“œ ë¹„í™œì„±í™”
                disableEditorFields(true);
                return;
            }

            // ì—ë””í„° í•„ë“œ í™œì„±í™”
            disableEditorFields(false);

            // ë°ì´í„° ë¡œë“œ
            titleInput.value = item.title;
            typeSelect.value = item.type;
            tagsInput.value = item.tags;
            questionTextarea.value = item.question;
            answerTextarea.value = item.answer;
            readonlyCheckbox.checked = item.isReadOnly;
            
           
            // íƒ€ì…ì— ë”°ë¼ ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
            updateBackgroundColor(item.type);
            
            // ë¬¸í•­ ë¡œë“œ ì‹œ ì§ˆë¬¸ ì˜ì—­ ë†’ì´ ì´ˆê¸°í™”/ì¬ê³„ì‚°
            autoExpandQuestionTextarea(questionTextarea); 

            // ê¸€ììˆ˜ ì—…ë°ì´íŠ¸
            updateCharCount();
            
            // ì½ê¸° ì „ìš© ìƒíƒœì— ë”°ë¼ í•„ë“œ ìƒíƒœ ë³€ê²½
            updateReadOnlyState(item.isReadOnly);
            
            // ë¬¸í•­ ëª©ë¡ UI ì—…ë°ì´íŠ¸
            renderSidebar();
        }
        
        /**
         * ë¬¸í•­ì´ ì—†ê±°ë‚˜ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ ì—ë””í„° í•„ë“œë¥¼ ë¹„í™œì„±í™”/í™œì„±í™”í•©ë‹ˆë‹¤.
         */
        function disableEditorFields(isDisabled) {
            [titleInput, typeSelect, tagsInput, questionTextarea, answerTextarea, readonlyCheckbox].forEach(el => {
                el.disabled = isDisabled;
                el.classList.toggle('opacity-50', isDisabled);
            });
        }
        
        /**
         * ë¬¸í•­ì˜ ì½ê¸° ì „ìš© ìƒíƒœì— ë”°ë¼ ì—ë””í„° í•„ë“œì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateReadOnlyState(isReadOnly) {
            const item = getCurrentItem();
            if (!item) return;
            
            // ì²´í¬ë°•ìŠ¤ ìì²´ëŠ” í•­ìƒ í™œì„±í™” (ì½ê¸° ì „ìš© ìƒíƒœ ë³€ê²½ ê°€ëŠ¥)
            
            // ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ì½ê¸° ì „ìš©ì´ë©´ ë¹„í™œì„±í™”
            [titleInput, typeSelect, tagsInput, questionTextarea, answerTextarea].forEach(el => {
                el.disabled = isReadOnly;
                el.classList.toggle('bg-gray-100', isReadOnly); // ì½ê¸° ì „ìš© ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½
            });
        }

        /**
         * íšŒì‚¬ ì •ë³´ì™€ ë¬¸í•­ ì •ë³´ë¥¼ ëª¨ë‘ ìƒˆë¡œ ê·¸ë¦½ë‹ˆë‹¤. (íšŒì‚¬ ë³€ê²½ ì‹œ ì‚¬ìš©)
         */
        function renderAppAndItemData() {
            renderApplicationData();
            renderSidebar();
            renderCurrentItem();
            renderAppList();
        }

        // ===============================================
        // 5. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        // ===============================================

        /**
         * ê¸€ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ UIì— í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function updateCharCount() {
            const text = answerTextarea.value;
            const countWithSpaces = text.length;
            // ì •ê·œì‹: ëª¨ë“  ê³µë°± ë¬¸ì(ìŠ¤í˜ì´ìŠ¤, íƒ­, ì¤„ë°”ê¿ˆ)ë¥¼ ì œê±°
            const countWithoutSpaces = text.replace(/\s/g, '').length; 

            document.querySelector('.count-with-spaces').textContent = `ê³µë°± í¬í•¨: ${countWithSpaces}ì`;
            document.querySelector('.count-without-spaces').textContent = `ê³µë°± ì œì™¸: ${countWithoutSpaces}ì`;
        }

        /**
         * ì‚¬ìš©ìì—ê²Œ í™•ì¸ì„ ìš”ì²­í•˜ëŠ” ì»¤ìŠ¤í…€ ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.
         * @returns {Promise<boolean>} ì‚¬ìš©ìì˜ í™•ì¸(true) ë˜ëŠ” ì·¨ì†Œ(false) ê²°ê³¼
         */
        function showConfirmModal(message) {
            return new Promise(resolve => {
                modalResolve = resolve;
                modalMessage.textContent = message;
                confirmModal.classList.remove('hidden');
                confirmModal.classList.add('flex');
            });
        }

        /**
         * ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì»¤ìŠ¤í…€ ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.
         */
        function showMessageModal(title, message) {
            messageModalTitle.textContent = title;
            messageModalMessage.textContent = message;
            messageModal.classList.remove('hidden');
            messageModal.classList.add('flex');
        }

        /**
         * í•„í„° ë©”ë‰´ì˜ í™œì„± ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
         */
        function toggleFilterMenu(show) {
            const shouldShow = show !== undefined ? show : filterMenu.classList.contains('hidden');
            
            if (shouldShow) {
                // í•„í„° ë©”ë‰´ ì—´ê¸°
                renderFilterCheckboxes();
                filterMenu.classList.remove('hidden');
                filterMenu.classList.add('flex');
                
                // ê²€ìƒ‰ ë©”ë‰´ ë° ì›ë˜ ë‚´ìš© ìˆ¨ê¸°ê¸°
                searchMenu.classList.add('hidden');
                originalContentContainer.classList.add('hidden');
            } else {
                // í•„í„° ë©”ë‰´ ë‹«ê¸°
                filterMenu.classList.add('hidden');
                filterMenu.classList.remove('flex');
                
                // ì›ë˜ ë‚´ìš© ë³´ì´ê¸°
                originalContentContainer.classList.remove('hidden');
            }
        }
        
        /**
         * ê²€ìƒ‰ ë©”ë‰´ì˜ í™œì„± ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
         */
        function toggleSearchMenu(show) {
            const shouldShow = show !== undefined ? show : searchMenu.classList.contains('hidden');

            if (shouldShow) {
                // ê²€ìƒ‰ ë©”ë‰´ ì—´ê¸°
                searchMenu.classList.remove('hidden');
                searchMenu.classList.add('flex');
                
                // í•„í„° ë©”ë‰´ ë° ì›ë˜ ë‚´ìš© ìˆ¨ê¸°ê¸°
                filterMenu.classList.add('hidden');
                originalContentContainer.classList.add('hidden');
                searchInput.focus(); // ê²€ìƒ‰ì°½ì— í¬ì»¤ìŠ¤
            } else {
                // ê²€ìƒ‰ ë©”ë‰´ ë‹«ê¸°
                searchMenu.classList.add('hidden');
                searchMenu.classList.remove('flex');

                // ì›ë˜ ë‚´ìš© ë³´ì´ê¸° (ë‹¨, í•„í„° ë©”ë‰´ê°€ ì—´ë ¤ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ)
                if (filterMenu.classList.contains('hidden')) {
                    originalContentContainer.classList.remove('hidden');
                }
            }
        }

        /**
         * ë°ì´í„° ì €ì¥ ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ì„ í† ê¸€í•©ë‹ˆë‹¤.
         */
        function toggleSaveDropdown() {
            saveDropdown.classList.toggle('hidden');
        }
        
        // ===============================================
        // 6. ë°ì´í„° ë¡œë“œ/ì €ì¥/ê²€ìƒ‰/í•„í„°ë§ ë¡œì§
        // ===============================================

        /**
         * ì „ì²´ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function downloadData(data, filename, type) {
            const dataStr = "data:" + type + ";charset=utf-8," + encodeURIComponent(data);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", filename);
            document.body.appendChild(downloadAnchorNode); // for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        /**
         * ê²€ìƒ‰ ê²°ê³¼ê°€ ì„ íƒë˜ì—ˆì„ ë•Œ, í•´ë‹¹ ë¬¸í•­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
         */
        function handleSearchResultClick(appId, itemId) {
            // 1. í˜„ì¬ í¸ì§‘ ì¤‘ì´ë˜ ë‚´ìš© ì €ì¥
            saveCurrentItem();
            saveApplicationData();
            
            // 2. ìƒˆë¡œìš´ íšŒì‚¬ì™€ ë¬¸í•­ ì¸ë±ìŠ¤ ì„¤ì •
            selectedAppId = appId;
            const app = getCurrentApplication();
            if (app) {
                const index = app.items.findIndex(item => item.id.toString() === itemId.toString());
                selectedItemIndex = index !== -1 ? index : 0;
            } else {
                selectedItemIndex = 0;
            }
            
            // 3. UI ì—…ë°ì´íŠ¸
            renderAppAndItemData();
            
            // 4. ê²€ìƒ‰ ë©”ë‰´ ë‹«ê¸°
            toggleSearchMenu(false);

            // 5. í•´ë‹¹ ë¬¸í•­ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤ (ì—ë””í„° ì˜ì—­ì´ ë³´ì´ë„ë¡)
            editorContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        /**
         * ê²€ìƒ‰ ê²°ê³¼ë¥¼ ëª©ë¡ì— ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderSearchResults() {
            searchResultsContainer.innerHTML = '';
            
            if (lastSearchQuery.length < 2) {
                searchInfo.textContent = "ê²€ìƒ‰ì–´ë¥¼ 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                return;
            }

            if (searchResults.length === 0) {
                searchInfo.textContent = `"${lastSearchQuery}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`;
                return;
            }

            searchInfo.textContent = `ì´ ${searchResults.length}ê°œì˜ ê²°ê³¼ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.`;

            searchResults.forEach(result => {
                const app = applications.find(a => a.id === result.appId);
                const item = app ? app.items.find(i => i.id === result.itemId) : null;
                
                if (!app || !item) return;

                const li = document.createElement('li');
                li.className = 'search-result-item bg-white p-3 rounded-lg shadow-md border-2 border-gray-200 hover:border-indigo-400 transition-all duration-150';
                li.dataset.appId = app.id;
                li.dataset.itemId = item.id;
                
                li.innerHTML = `
                    <div class="text-xs font-medium text-indigo-600 truncate mb-1">
                        ${app.company} (${app.status})
                    </div>
                    <div class="text-sm font-bold text-gray-800 truncate mb-1">
                        ${item.title.trim() || '(ì œëª© ì—†ìŒ)'} 
                        <span class="text-xs font-medium text-gray-500 ml-1">(${item.type})</span>
                    </div>
                    <!-- ë§¤ì¹­ëœ ìŠ¤ë‹ˆí« í‘œì‹œ (ì˜ˆì‹œ) -->
                    <p class="text-xs text-gray-600 line-clamp-2 mt-1">
                        ${result.snippet.length > 100 ? result.snippet.substring(0, 100) + '...' : result.snippet}
                    </p>
                `;
                
                li.addEventListener('click', () => handleSearchResultClick(result.appId, result.itemId));
                searchResultsContainer.appendChild(li);
            });
        }
        
        /**
         * ì „ì²´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
         */
        function performSearch(query) {
            lastSearchQuery = query.trim().toLowerCase();
            searchResults = [];
            
            if (lastSearchQuery.length < 2) {
                renderSearchResults();
                return;
            }
            
            applications.forEach(app => {
                app.items.forEach(item => {
                    let snippet = '';
                    let matchFound = false;
                    
                    // 1. íšŒì‚¬ëª… ê²€ìƒ‰
                    if (activeSearchFilters.includes("íšŒì‚¬ëª…") && app.company.toLowerCase().includes(lastSearchQuery)) {
                        snippet = `[íšŒì‚¬ëª… ë§¤ì¹­]: ${app.company}`;
                        matchFound = true;
                    } 
                    
                    // 2. ì§ˆë¬¸ ê²€ìƒ‰
                    else if (activeSearchFilters.includes("ì§ˆë¬¸") && item.question.toLowerCase().includes(lastSearchQuery)) {
                        snippet = `[ì§ˆë¬¸ ë§¤ì¹­]: ${item.question}`;
                        matchFound = true;
                    } 
                    
                    // 3. ë‹µë³€ ê²€ìƒ‰
                    else if (activeSearchFilters.includes("ë‹µë³€") && item.answer.toLowerCase().includes(lastSearchQuery)) {
                        snippet = `[ë‹µë³€ ë§¤ì¹­]: ${item.answer}`;
                        matchFound = true;
                    }
                    
                    // 4. ìœ í˜• ê²€ìƒ‰ (Type ë˜ëŠ” Tag)
                    else if (activeSearchFilters.includes("ìœ í˜•") && 
                             (item.type.toLowerCase().includes(lastSearchQuery) || 
                              item.tags.toLowerCase().includes(lastSearchQuery))) {
                        snippet = `[ìœ í˜• ë§¤ì¹­]: ${item.type}, ${item.tags}`;
                        matchFound = true;
                    }

                    if (matchFound) {
                        searchResults.push({
                            appId: app.id,
                            itemId: item.id,
                            snippet: snippet // ì‹¤ì œë¡œëŠ” í•˜ì´ë¼ì´íŒ… ë¡œì§ì´ ë” ë³µì¡í•  ìˆ˜ ìˆìŒ
                        });
                    }
                });
            });

            renderSearchResults();
        }
        
        /**
         * ê²€ìƒ‰ í•„í„° ëª¨ë‹¬ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ë Œë”ë§í•˜ê³  ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function renderSearchFilterCheckboxes() {
            searchFilterCheckboxesModalDiv.innerHTML = '';
            
            searchFields.forEach(field => {
                const isChecked = activeSearchFilters.includes(field);
                
                const div = document.createElement('div');
                div.className = 'flex items-center select-none';
                
                div.innerHTML = `
                    <input type="checkbox" id="search-filter-${field}" data-field="${field}" ${isChecked ? 'checked' : ''} 
                           class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer">
                    <label for="search-filter-${field}" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                        ${field}
                    </label>
                `;
                
                const checkbox = div.querySelector('input');
                checkbox.addEventListener('change', (event) => {
                    const field = event.target.dataset.field;
                    const isChecked = event.target.checked;
                    
                    if (isChecked) {
                        if (!activeSearchFilters.includes(field)) {
                            activeSearchFilters.push(field);
                        }
                    } else {
                        activeSearchFilters = activeSearchFilters.filter(f => f !== field);
                    }
                    
                    // í•„í„° ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    updateSearchFilterButtonText();
                });
                
                searchFilterCheckboxesModalDiv.appendChild(div);
            });
            
            updateSearchFilterButtonText();
        }
        
        /**
         * ê²€ìƒ‰ í•„í„° ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateSearchFilterButtonText() {
            openSearchFilterModalBtn.textContent = `í•„í„° ì„¤ì • (${activeSearchFilters.length} / ${searchFields.length})`;
        }

        /**
         * í•„í„° ë©”ë‰´ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderFilterCheckboxes() {
            statusCheckboxesDiv.innerHTML = '';
            
            filterOrder.forEach(status => {
                const isChecked = activeStatuses.includes(status);
                
                const div = document.createElement('div');
                div.className = 'flex items-center select-none p-1 rounded-md hover:bg-gray-200 transition-colors';
                
                div.innerHTML = `
                    <input type="checkbox" id="status-filter-${status}" data-status="${status}" ${isChecked ? 'checked' : ''}
                           class="h-4 w-4 text-gray-600 border-gray-300 rounded focus:ring-cyan-500 cursor-pointer">
                    <label for="status-filter-${status}" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                        ${status}
                    </label>
                `;
                
                const checkbox = div.querySelector('input');
                checkbox.addEventListener('change', handleStatusCheckboxChange);
                
                statusCheckboxesDiv.appendChild(div);
            });
        }
        
        /**
         * ìƒíƒœ í•„í„° ì²´í¬ë°•ìŠ¤ì˜ ë³€ê²½ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         */
        function handleStatusCheckboxChange(event) {
            const status = event.target.dataset.status;
            const isChecked = event.target.checked;

            if (isChecked) {
                if (!activeStatuses.includes(status)) {
                    activeStatuses.push(status);
                }
            } else {
                activeStatuses = activeStatuses.filter(s => s !== status);
            }
            
            renderAppList();
        }

        function selectAllStatuses() {
            activeStatuses = [...filterOrder];
            renderFilterCheckboxes();
            renderAppList();
        }
        
        function selectNoneStatuses() {
            activeStatuses = [];
            renderFilterCheckboxes();
            renderAppList();
        }

        function selectCompanyOnlyStatuses() {
            const allCompanySelected = companyStatuses.every(status => activeStatuses.includes(status));
            
            if (allCompanySelected && activeStatuses.length === companyStatuses.length) {
                activeStatuses = [];
            } else {
                activeStatuses = [...companyStatuses];
            }
            
            renderFilterCheckboxes();
            renderAppList();
        }
        
        /**
         * ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì´ˆê¸°í™” ì‹œì ì— ì„¤ì •í•©ë‹ˆë‹¤.
         */
        function setupEventListeners() {
            // --- 1. íšŒì‚¬/App ëª©ë¡ ê´€ë ¨ ì´ë²¤íŠ¸ ---
            addAppBtn.addEventListener('click', () => {
                saveCurrentItem();
                saveApplicationData();
                const newApp = defaultApplication(applications.length + 1);
                applications.push(newApp);
                selectedAppId = newApp.id;
                selectedItemIndex = 0;
                renderAppAndItemData();
                // â­ [ìˆ˜ì •] íšŒì‚¬ ì¶”ê°€ ì‹œ ì•Œë¦¼ ì œê±°
                // showMessageModal('ì•Œë¦¼', `ìƒˆ íšŒì‚¬ '${newApp.company}'ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`);
            });

            removeAppBtn.addEventListener('click', async () => {
                if (applications.length <= 1) {
                    showMessageModal('ê²½ê³ ', 'ìµœì†Œ í•˜ë‚˜ì˜ íšŒì‚¬ëŠ” ë‚¨ê²¨ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }
                const app = getCurrentApplication();
                const confirmed = await showConfirmModal(`íšŒì‚¬ '${app.company}'ì™€ ê·¸ì— ì†í•œ ëª¨ë“  ë¬¸í•­ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
                if (confirmed) {
                    applications = applications.filter(a => a.id !== selectedAppId);
                    // ìƒˆ ì„ íƒ: ì²« ë²ˆì§¸ íšŒì‚¬
                    selectedAppId = applications[0].id; 
                    selectedItemIndex = 0;
                    renderAppAndItemData();
                    showMessageModal('ì•Œë¦¼', `'${app.company}'ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.`);
                }
            });

            // --- 2. Middle Sidebar (ìƒì„¸ ì •ë³´) ê´€ë ¨ ì´ë²¤íŠ¸ ---
            
            // íšŒì‚¬ëª… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (on 'input' event)
            appCompanyInput.addEventListener('input', () => {
                // 1. ë°ì´í„°ì— í˜„ì¬ ê°’ ì €ì¥
                saveApplicationData();
                // 2. íšŒì‚¬ ëª©ë¡ UIë¥¼ ë‹¤ì‹œ ê·¸ë ¤ì„œ (ì‹¤ì‹œê°„ ë°˜ì˜)
                renderAppList(); 
            });

            // ë‚ ì§œ ë° ìƒíƒœ ë³€ê²½ ì‹œ, ë°ì´í„° ì €ì¥ ë° íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
            appDateInput.addEventListener('change', () => {
                saveApplicationData();
            });
            appStatusSelect.addEventListener('change', () => {
                saveApplicationData();
            });


            // --- 3. ë¬¸í•­ ëª©ë¡ ê´€ë ¨ ì´ë²¤íŠ¸ ---
            addItemBtn.addEventListener('click', () => {
                const app = getCurrentApplication();
                if (!app) return;
                
                saveCurrentItem();
                
                const newItem = defaultItem(app.items.length + 1);
                app.items.push(newItem);
                selectedItemIndex = app.items.length - 1; // ë§ˆì§€ë§‰ í•­ëª© ì„ íƒ
                renderAppAndItemData();
            });
            
            removeItemBtn.addEventListener('click', async () => {
                const app = getCurrentApplication();
                if (!app || app.items.length === 0) return;
                
                const item = getCurrentItem();
                const confirmed = await showConfirmModal(`ë¬¸í•­ '${item.title}'ë¥¼ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);

                if (confirmed) {
                    app.items.splice(selectedItemIndex, 1);
                    selectedItemIndex = Math.max(0, selectedItemIndex - 1); // ì¸ë±ìŠ¤ ì¡°ì •
                    renderAppAndItemData();
                }
            });
            

            // --- 4. ë¬¸í•­ í¸ì§‘ê¸° ê´€ë ¨ ì´ë²¤íŠ¸ (ì‹¤ì‹œê°„ ì €ì¥) ---
            titleInput.addEventListener('input', saveCurrentItem);
            typeSelect.addEventListener('change', () => {
                saveCurrentItem();
                updateBackgroundColor(typeSelect.value); // ë°°ê²½ìƒ‰ ì¦‰ì‹œ ë³€ê²½
            });
            tagsInput.addEventListener('input', saveCurrentItem);
            questionTextarea.addEventListener('input', saveCurrentItem);
            answerTextarea.addEventListener('input', () => {
                autoExpandQuestionTextarea(questionTextarea);
                saveCurrentItem();
                updateCharCount(); // ê¸€ììˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            });
            
            readonlyCheckbox.addEventListener('change', () => {
                saveCurrentItem();
                updateReadOnlyState(readonlyCheckbox.checked);
            });


            // --- 5. ëª¨ë‹¬ ê´€ë ¨ ì´ë²¤íŠ¸ ---
            modalConfirmBtn.addEventListener('click', () => {
                confirmModal.classList.add('hidden');
                confirmModal.classList.remove('flex');
                if (modalResolve) modalResolve(true);
                modalResolve = null;
            });
            
            modalCancelBtn.addEventListener('click', () => {
                confirmModal.classList.add('hidden');
                confirmModal.classList.remove('flex');
                if (modalResolve) modalResolve(false);
                modalResolve = null;
            });

            messageModalCloseBtn.addEventListener('click', () => {
                messageModal.classList.add('hidden');
                messageModal.classList.remove('flex');
            });
            
            // --- 6. ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê´€ë ¨ ì´ë²¤íŠ¸ ---
            saveDataBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // ë²„íŠ¼ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ í† ê¸€
                toggleSaveDropdown();
            });
            document.addEventListener('click', (e) => {
                // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                if (!saveDataBtn.contains(e.target) && !saveDropdown.contains(e.target) && !saveDropdown.classList.contains('hidden')) {
                    toggleSaveDropdown();
                }
            });

            saveJsonBtn.addEventListener('click', () => {
                saveCurrentItem();
                saveApplicationData();
                const jsonContent = JSON.stringify(applications, null, 2);
                downloadData(jsonContent, 'project_data.json', 'application/json');
                toggleSaveDropdown();
                showMessageModal('ì•Œë¦¼', 'JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            });
            
            saveTextBtn.addEventListener('click', () => {
                saveCurrentItem();
                saveApplicationData();
                const textContent = JSON.stringify(applications, null, 2); // í…ìŠ¤íŠ¸ íŒŒì¼ë„ JSON í˜•íƒœë¡œ ì €ì¥
                downloadData(textContent, 'project_data.txt', 'text/plain');
                toggleSaveDropdown();
                showMessageModal('ì•Œë¦¼', 'Text íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            });

            loadDataBtn.addEventListener('click', () => {
                fileLoader.click();
            });
            
            fileLoader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const loadedData = JSON.parse(e.target.result);
                        
                        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (ìµœì†Œí•œì˜ êµ¬ì¡° í™•ì¸)
                        if (Array.isArray(loadedData) && loadedData.every(item => 'id' in item && 'company' in item)) {
                            const confirmed = await showConfirmModal('í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë°ì´í„°ê°€ ëª¨ë‘ ëŒ€ì²´ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                            
                            if (confirmed) {
                                applications = loadedData;
                                selectedAppId = applications[0]?.id; 
                                selectedItemIndex = 0;
                                renderAppAndItemData();
                                showMessageModal('ì„±ê³µ', 'ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                            }
                        } else {
                            showMessageModal('ì˜¤ë¥˜', 'ë¶ˆëŸ¬ì˜¨ íŒŒì¼ì˜ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        showMessageModal('ì˜¤ë¥˜', 'íŒŒì¼ì„ ì½ê±°ë‚˜ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        console.error("File loading error:", error);
                    }
                };
                reader.readAsText(file);
            });
            
            // --- 7. í•„í„° ë©”ë‰´ ê´€ë ¨ ì´ë²¤íŠ¸ ---
            filterToggleButton.addEventListener('click', () => toggleFilterMenu());
            closeFilterBtn.addEventListener('click', () => toggleFilterMenu(false));
            selectAllBtn.addEventListener('click', selectAllStatuses);
            selectNoneBtn.addEventListener('click', selectNoneStatuses);
            selectCompanyOnlyBtn.addEventListener('click', selectCompanyOnlyStatuses);
            
            // --- 8. ê²€ìƒ‰ ë©”ë‰´ ê´€ë ¨ ì´ë²¤íŠ¸ ---
            searchToggleButton.addEventListener('click', () => toggleSearchMenu());
            closeSearchBtn.addEventListener('click', () => toggleSearchMenu(false));
            
            // ê²€ìƒ‰ í•„í„° ëª¨ë‹¬
            openSearchFilterModalBtn.addEventListener('click', () => {
                renderSearchFilterCheckboxes();
                searchFilterModal.classList.remove('hidden');
                searchFilterModal.classList.add('flex');
            });
            searchFilterModalCloseBtn.addEventListener('click', () => {
                searchFilterModal.classList.add('hidden');
                searchFilterModal.classList.remove('flex');
                
                // í•„í„° ì„¤ì • ë³€ê²½ ì‹œ ê²€ìƒ‰ ì¬ì‹¤í–‰
                if (lastSearchQuery) {
                    performSearch(lastSearchQuery);
                }
            });
            
            // ê²€ìƒ‰ ì…ë ¥ í•„ë“œ (input ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ ê²€ìƒ‰)
            searchInput.addEventListener('input', (event) => {
                performSearch(event.target.value);
            });

            // ì§ˆë¬¸/ë‹µë³€ í•„ë“œ ë³€ê²½ ì‹œ ë°ì´í„° ì €ì¥ ë° ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
            questionTextarea.addEventListener('input', () => {
                autoExpandQuestionTextarea(questionTextarea); // [MODIFIED] ìë™ í™•ì¥ ê¸°ëŠ¥ ì¶”ê°€
                saveCurrentItem();
                updateCharCount();
            });
            answerTextarea.addEventListener('input', () => {
                saveCurrentItem();
                updateCharCount();
            });
        }
        
        /**
         * ì•± ì´ˆê¸°í™” í•¨ìˆ˜: ë°ì´í„° ë¡œë“œ ë° UI ë Œë”ë§ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
         */
        function initializeApp() {
            // ì´ˆê¸° ë°ì´í„° ì„¤ì •
            if (applications.length === 0) {
                const newApp = defaultApplication(1);
                applications.push(newApp);
                selectedAppId = newApp.id;
            } else {
                selectedAppId = applications[0].id;
                selectedItemIndex = 0;
            }
            
            // ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // ì´ˆê¸° UI ë Œë”ë§
            renderAppAndItemData();
            
            // ì´ˆê¸° í•„í„° ìƒíƒœ (ì „ì²´ ì„ íƒ)
            selectAllStatuses();
        }

        // ì•± ì´ˆê¸°í™”
        window.onload = initializeApp;

    </script>
</body>
</html>
